<div class="flex flex-col flex-col-reverse lg:flex-row gap-3 p-4">

  <!-- Transactions (2/3) -->
  <div class="w-full lg:w-2/3 space-y-4">

    <!-- Filter toggle button for small devices -->
    <div class="lg:hidden flex justify-center" [class.mb-2]="showFilters" [class.mb-4]="!showFilters">
      <button (click)="toggleFilters()" 
        class="bg-gray-500 text-white px-3 py-1 rounded-lg text-xs font-medium hover:bg-gray-600 flex items-center gap-2">
        <mat-icon class="text-sm">{{ showFilters ? 'expand_less' : 'expand_more' }}</mat-icon>
        {{ showFilters ? 'Hide Filters' : 'Show Filters' }}
      </button>
    </div>

    <!-- Bulk controls -->
    <div *ngIf="showBulkCategorize" class="flex items-center gap-3">
      <span class="font-semibold text-xs text-sky-500">
        {{ selectedCount() === 0 ? 'Please select transactions' : 'Selected ' + selectedCount() + ' transaction' +
        (selectedCount() > 1 ? 's' : '') }}
      </span>
      <button (click)="onBulkProceed()" [disabled]="!anySelected()"
        class="bg-sky-500 text-white px-4 py-1 rounded-lg text-xs font-medium hover:bg-sky-600 disabled:opacity-50">
        Proceed
      </button>
      <button (click)="toggleBulkCategorize()"
        class="bg-gray-300 text-gray-700 px-4 py-1 rounded-lg text-xs font-medium hover:bg-gray-400">
        Cancel
      </button>
    </div>

    <div *ngIf="!showBulkCategorize && totalItems > 1">
      <button (click)="toggleBulkCategorize()"
        class="bg-sky-500 text-white px-4 py-1 rounded-lg text-xs font-medium hover:bg-sky-600">
        Categorize multiple transactions
      </button>
    </div>

    <div *ngIf="totalItems === 0" class="text-center">
      <h2>No transaction found.</h2>
    </div>

    <!-- Cards -->
    <div *ngFor="let tx of transactions"
      class="flex items-start bg-white/80 backdrop-blur rounded-2xl p-4 space-x-4 sm:pl-10 sm:pr-10 min-h-32">
      <!-- 1) Bulk checkbox -->
      <div *ngIf="showBulkCategorize" class="flex-shrink-0">
        <input type="checkbox" [(ngModel)]="tx.selected" class="h-5 w-5 mt-1 cursor-pointer" />
      </div>

      <!-- 2) Direction arrow -->
      <div class="flex-shrink-0 mt-1">
        <mat-icon [style.color]="tx.direction === 'c' ? 'red' : 'green'">
          {{ tx.direction === 'c' ? 'arrow_upward' : 'arrow_downward' }}
        </mat-icon>
      </div>

      <!-- 3) Main info -->
      <div class="flex-1 flex flex-col">
        <div class="text-xs text-gray-500">ID: {{ tx.id }}</div>
        <div class="text-lg text-sky-500 font-bold">{{ tx.beneficiaryName }}</div>
        <div class="text-sm text-gray-600">{{ tx.date | date:'dd.MM.yyyy.' }}</div>
        <div class="text-sm text-gray-600">{{ kindLabels[tx.kind] || tx.kind }}</div>

        <!-- Category or Splits -->
        <div class="mt-2">
          <ng-container *ngIf="tx.splits.length > 0; else showCategory">
            <div class="flex flex-wrap gap-2">
              <span *ngFor="let sp of tx.splits"
                class="inline-block bg-cyan-500 text-white px-2 py-1 rounded-sm text-xs">
                {{ sp.category?.name || sp.catCode }}
                {{ sp.amount | number:'1.2-2' }}
              </span>
            </div>
          </ng-container>

          <ng-template #showCategory>
            <ng-container *ngIf="tx.category; else addCat">
              <span (click)="openCategorizeDialog(tx)"
                class="inline-block bg-sky-500 text-white px-2 py-1 rounded-sm text-xs cursor-pointer">
                {{ tx.category.name }}
              </span>
            </ng-container>
            <ng-template #addCat>
              <button (click)="openCategorizeDialog(tx)"
                class="inline-flex items-center text-gray-700 text-xs font-medium mt-1">
                <mat-icon class="text-xs">add</mat-icon>
                <span class="ml-1">Add category</span>
              </button>
            </ng-template>
          </ng-template>
        </div>
      </div>

      <!-- 4) Actions: stretch full height and justify between -->
      <div class="flex-shrink-0 flex flex-col items-end justify-between min-h-24">
        <div>
          <div class="text-xl font-bold text-sky-500">
            {{ tx.amount | number:'1.2-2' }} {{ tx.currency }}
          </div>
        </div>
        <button (click)="openSplitDialog(tx)"
          class="bg-sky-500 text-white px-4 py-1 rounded-lg text-xs font-medium hover:bg-sky-600">
          Split transaction
        </button>
      </div>
    </div>

    <!-- Paginator -->
    <div *ngIf="totalItems > 1" class="flex justify-center mt-4">
      <mat-paginator [length]="totalItems" [pageSize]="pageSize" [pageSizeOptions]="[10,20,50]"
        (page)="onPageChange($event)">
      </mat-paginator>
    </div>

  </div>

  <!-- Filters (1/3) -->
  <div class="w-full lg:w-1/3" [class.hidden]="!showFilters" [class.lg:block]="true">
    <div class="p-4">
      <div class="uppercase text-xs font-bold text-gray-500 border-b-2 border-sky-500 pb-1 mb-3">
        Period
      </div>
      <div class="space-y-3">
        <div>
          <label for="fromDate" class="block text-xs font-semibold uppercase mb-1">From</label>
          <input type="date" id="fromDate" name="fromDate" [(ngModel)]="fromDate"
            class="w-full bg-sky-500 text-white px-3 py-1.5 rounded focus:ring-sky-500" />
        </div>
        <div>
          <label for="toDate" class="block text-xs font-semibold uppercase mb-1">To</label>
          <input type="date" id="toDate" name="toDate" [(ngModel)]="toDate"
            class="w-full bg-sky-500 text-white px-3 py-1.5 rounded focus:ring-sky-500" />
        </div>
      </div>

      <div class="mt-4 uppercase text-xs font-bold text-gray-500 border-b-2 border-sky-500 pb-1 mb-3">
        Transaction Kind
      </div>
      <select id="transactionKind" name="transactionKind" [(ngModel)]="selectedKind"
        class="w-full bg-sky-500 text-white px-3 py-1.5 rounded focus:ring-sky-500 mb-4">
        <option value="">All</option>
        <option *ngFor="let k of transactionKinds" [value]="k">{{ kindLabels[k] || k }}</option>
      </select>

      <div class="flex flex-col gap-2">
        <button (click)="onFilterApply()" class="w-full bg-green-600 text-white py-1.5 rounded hover:bg-green-700">
          Filter Transactions
        </button>
        <button (click)="onFilterClear()" class="w-full bg-gray-300 text-gray-700 py-1.5 rounded hover:bg-gray-400">
          Clear Selections
        </button>
      </div>
    </div>
  </div>

</div>